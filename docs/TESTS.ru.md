# Tires — Тесты

Все тесты запускаются **без sudo** с использованием `MockCapacity` для имитации размеров уровней.

## Запуск тестов

```bash
# Все тесты
./Tests/tires-test-runner.sh

# Список доступных тестов
./Tests/tires-test-runner.sh --list

# Конкретные тесты
./Tests/tires-test-runner.sh default folders hardlinks
```

## Доступные тесты

| Тест | Описание |
|------|----------|
| `default` | Базовое перемещение файлов между 2 уровнями |
| `folders` | Обработка вложенных директорий |
| `hardlinks` | Сохранение жёстких ссылок при перемещении |
| `symlink` | Сохранение символьных ссылок при перемещении |
| `folder-rules` | Тесты приоритетов и сортировки правил |
| `ignore-rule` | Тесты исключения папок |
| `bigfiles` | Тестирование больших файлов (4МБ/8МБ mock) |
| `capacity-limit` | Тестирование ограничения ёмкости (2МБ/10МБ mock) |
| `multi-tier` | Тестирование распределения на 3 уровня |
| `competing-rules` | Тестирование конкурирующих правил |
| `multiple-rules` | Тестирование нескольких правил для одной папки |
| `redistribution` | Тестирование перераспределения файлов |
| `rule-priority-capacity` | Тесты приоритета правил с ограниченной ёмкостью |
| `size-edge-cases` | Тестирование граничных случаев размеров |

## Структура тестов

```
Tests/
├── tires-test-runner.sh    # Основной запускающий скрипт
├── common.sh               # Общие утилиты тестов
├── default/                # Базовые тесты
├── folders/                # Тесты вложенных директорий
├── hardlinks/              # Тесты жёстких ссылок
├── symlink/                # Тесты символьных ссылок
├── folder-rules/           # Тесты приоритета правил
├── ignore-rule/            # Тесты исключений
├── bigfiles/               # Тесты больших файлов
├── capacity-limit/         # Тесты ограничения ёмкости
├── multi-tier/             # Тесты 3 уровней
├── competing-rules/        # Тесты конкурирующих правил
├── multiple-rules/         # Тесты нескольких правил
├── redistribution/         # Тесты перераспределения
├── rule-priority-capacity/ # Тесты приоритета с ёмкостью
└── size-edge-cases/        # Тесты граничных случаев
```

## Как работают тесты

Тесты используют `MockCapacity` в конфигурации для имитации размеров уровней без необходимости создания реальных дисковых разделов:

```json
{
    "Tiers": [
        {"target": 100, "path": "/tmp/hot", "MockCapacity": 2097152},
        {"target": 100, "path": "/tmp/cold", "MockCapacity": 10485760}
    ]
}
```

Это позволяет запускать тесты:
- ✅ Без привилегий root
- ✅ Без реальных дисковых разделов
- ✅ В среде CI/CD
- ✅ С предсказуемыми результатами

## Добавление новых тестов

1. Создайте директорию теста: `mkdir Tests/my-test`
2. Добавьте `config.json` с конфигурацией теста
3. Добавьте тестовые файлы для имитации
4. Запустите: `./Tests/tires-test-runner.sh my-test`

Смотрите существующие тесты для примеров.

## Особенности тестирования

### Сохранение метаданных

Тесты проверяют, что при перемещении файлов сохраняются:
- Права доступа (permissions)
- Владелец (ownership)
- Временные метки (timestamps)
- Жёсткие ссылки (hardlinks)
- Символьные ссылки (symlinks)

### MockCapacity

Значения `MockCapacity` указываются в байтах:
- `2097152` = 2 МБ
- `10485760` = 10 МБ
- `1073741824` = 1 ГБ

### Тестирование без sudo

Все тесты используют временные директории в `/tmp` и не требуют прав суперпользователя.

## Смотрите также

- **[English Tests Documentation](TESTS.md)** — English documentation
- **[Примеры](../examples/README.md)** — Примеры конфигурации
- **[Документация](README.md)** — Основная документация
